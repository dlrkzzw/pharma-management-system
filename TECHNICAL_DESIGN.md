# åŒ»è¯ä»£è¡¨ä¸šåŠ¡ç®¡ç†ç³»ç»Ÿ - æŠ€æœ¯è®¾è®¡æ–‡æ¡£ v1.1.0

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›®ä¿¡æ¯ | è¯¦æƒ… |
|---------|------|
| **é¡¹ç›®åç§°** | åŒ»è¯ä»£è¡¨ä¸šåŠ¡ç®¡ç†ç³»ç»Ÿ |
| **ç‰ˆæœ¬** | v1.1.0 |
| **æ–‡æ¡£ç±»å‹** | æŠ€æœ¯è®¾è®¡æ–‡æ¡£ |
| **åˆ›å»ºæ—¥æœŸ** | 2025-05-27 |
| **æŠ€æœ¯æ ˆ** | React + TypeScript + Node.js + Express + SQLite |

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±‚ (Frontend)                         â”‚
â”‚  React 18 + TypeScript + Ant Design + Vite                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    APIå±‚ (API Layer)                       â”‚
â”‚           RESTful API + Express + CORS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   ä¸šåŠ¡é€»è¾‘å±‚ (Business)                      â”‚
â”‚        è·¯ç”±æ§åˆ¶ + æ•°æ®éªŒè¯ + ä¸šåŠ¡è§„åˆ™                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   æ•°æ®è®¿é—®å±‚ (Data Access)                   â”‚
â”‚              SQLite + äº‹åŠ¡ç®¡ç† + æ•°æ®è¿ç§»                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯é€‰å‹ç†ç”±

| æŠ€æœ¯ | é€‰å‹ç†ç”± |
|------|----------|
| **React 18** | ç°ä»£åŒ–å‰ç«¯æ¡†æ¶ï¼Œç»„ä»¶åŒ–å¼€å‘ï¼Œç”Ÿæ€å®Œå–„ |
| **TypeScript** | ç±»å‹å®‰å…¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯ï¼Œæé«˜ä»£ç è´¨é‡ |
| **Ant Design** | ä¼ä¸šçº§UIç»„ä»¶åº“ï¼Œå¼€ç®±å³ç”¨ï¼Œè®¾è®¡è§„èŒƒ |
| **Express** | è½»é‡çº§Webæ¡†æ¶ï¼Œä¸­é—´ä»¶ä¸°å¯Œï¼Œæ˜“äºæ‰©å±• |
| **SQLite** | è½»é‡çº§æ•°æ®åº“ï¼Œæ— éœ€å®‰è£…ï¼Œé€‚åˆä¸­å°å‹åº”ç”¨ |

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ERå›¾å…³ç³»

```
medicines (è¯å“è¡¨)
    â”œâ”€â”€ 1:N â†’ order_details (è®¢å•æ˜ç»†)
    â”œâ”€â”€ 1:N â†’ inventory_movements (åº“å­˜å˜åŠ¨)
    â””â”€â”€ 1:N â†’ purchase_records (è¿›è´§è®°å½•)

hospitals (åŒ»é™¢è¡¨)
    â”œâ”€â”€ 1:N â†’ doctors (åŒ»ç”Ÿè¡¨)
    â””â”€â”€ 1:N â†’ sales_orders (é”€å”®è®¢å•)

doctors (åŒ»ç”Ÿè¡¨)
    â””â”€â”€ 1:N â†’ sales_orders (é”€å”®è®¢å•)

employees (å‘˜å·¥è¡¨)
    â””â”€â”€ 1:N â†’ sales_orders (é”€å”®è®¢å•)

sales_orders (é”€å”®è®¢å•è¡¨)
    â”œâ”€â”€ 1:N â†’ order_details (è®¢å•æ˜ç»†)
    â””â”€â”€ 1:N â†’ inventory_movements (åº“å­˜å˜åŠ¨)
```

### è¡¨ç»“æ„è®¾è®¡

#### 1. medicines (è¯å“è¡¨)
```sql
CREATE TABLE medicines (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,                    -- è¯å“åç§°
  specification TEXT,                    -- è§„æ ¼
  manufacturer TEXT,                     -- ç”Ÿäº§å‚å®¶
  approval_number TEXT,                  -- æ‰¹å‡†æ–‡å·
  dosage_form TEXT,                      -- å‰‚å‹
  unit_price DECIMAL(10,2),             -- é”€å”®å•ä»·
  purchase_price DECIMAL(10,2),         -- è¿›è´§ä»·æ ¼
  stock_quantity INTEGER DEFAULT 0,      -- åº“å­˜æ•°é‡
  min_stock_level INTEGER DEFAULT 10,    -- æœ€ä½åº“å­˜é¢„è­¦
  storage_conditions TEXT,               -- å‚¨å­˜æ¡ä»¶
  notes TEXT,                           -- å¤‡æ³¨
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 2. hospitals (åŒ»é™¢è¡¨)
```sql
CREATE TABLE hospitals (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,                    -- åŒ»é™¢åç§°
  level TEXT,                           -- åŒ»é™¢ç­‰çº§
  address TEXT,                         -- åœ°å€
  phone TEXT,                           -- ç”µè¯
  contact_person TEXT,                  -- è”ç³»äºº
  credit_level TEXT DEFAULT 'good',     -- ä¿¡ç”¨ç­‰çº§
  notes TEXT,                           -- å¤‡æ³¨
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 3. doctors (åŒ»ç”Ÿè¡¨)
```sql
CREATE TABLE doctors (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,                    -- åŒ»ç”Ÿå§“å
  hospital_id INTEGER,                   -- æ‰€å±åŒ»é™¢ID
  department TEXT,                       -- ç§‘å®¤
  position TEXT,                         -- èŒä½
  phone TEXT,                           -- ç”µè¯
  wechat TEXT,                          -- å¾®ä¿¡
  email TEXT,                           -- é‚®ç®±
  notes TEXT,                           -- å¤‡æ³¨
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (hospital_id) REFERENCES hospitals (id)
);
```

#### 4. employees (å‘˜å·¥è¡¨)
```sql
CREATE TABLE employees (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,                    -- å‘˜å·¥å§“å
  phone TEXT,                           -- ç”µè¯
  hire_date DATE,                       -- å…¥èŒæ—¥æœŸ
  role TEXT DEFAULT 'salesperson',      -- è§’è‰²
  status TEXT DEFAULT 'active',         -- çŠ¶æ€
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 5. sales_orders (é”€å”®è®¢å•è¡¨)
```sql
CREATE TABLE sales_orders (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_number TEXT UNIQUE NOT NULL,     -- è®¢å•ç¼–å·
  hospital_id INTEGER,                   -- åŒ»é™¢ID
  doctor_id INTEGER,                     -- åŒ»ç”ŸID
  employee_id INTEGER,                   -- è´Ÿè´£å‘˜å·¥ID
  order_date DATE,                       -- è®¢å•æ—¥æœŸ
  status TEXT DEFAULT 'pending',         -- è®¢å•çŠ¶æ€
  total_amount DECIMAL(10,2),           -- è®¢å•æ€»é‡‘é¢
  payment_status TEXT DEFAULT 'unpaid', -- ä»˜æ¬¾çŠ¶æ€
  notes TEXT,                           -- å¤‡æ³¨
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (hospital_id) REFERENCES hospitals (id),
  FOREIGN KEY (doctor_id) REFERENCES doctors (id),
  FOREIGN KEY (employee_id) REFERENCES employees (id)
);
```

#### 6. order_details (è®¢å•æ˜ç»†è¡¨)
```sql
CREATE TABLE order_details (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_id INTEGER,                      -- è®¢å•ID
  medicine_id INTEGER,                   -- è¯å“ID
  quantity INTEGER,                      -- æ•°é‡
  unit_price DECIMAL(10,2),             -- å•ä»·
  subtotal DECIMAL(10,2),               -- å°è®¡
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (order_id) REFERENCES sales_orders (id),
  FOREIGN KEY (medicine_id) REFERENCES medicines (id)
);
```

#### 7. inventory_movements (åº“å­˜å˜åŠ¨è®°å½•è¡¨) ğŸ†•
```sql
CREATE TABLE inventory_movements (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  medicine_id INTEGER,                   -- è¯å“ID
  movement_type TEXT NOT NULL,           -- å˜åŠ¨ç±»å‹: 'in'è¿›è´§, 'out'å‡ºè´§, 'adjustment'è°ƒæ•´
  quantity INTEGER NOT NULL,             -- å˜åŠ¨æ•°é‡
  reference_type TEXT,                   -- å…³è”ç±»å‹: 'purchase'è¿›è´§, 'order'è®¢å•, 'adjustment'è°ƒæ•´
  reference_id INTEGER,                  -- å…³è”è®°å½•ID
  notes TEXT,                           -- å¤‡æ³¨
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (medicine_id) REFERENCES medicines (id)
);
```

#### 8. purchase_records (è¿›è´§è®°å½•è¡¨) ğŸ†•
```sql
CREATE TABLE purchase_records (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  medicine_id INTEGER,                   -- è¯å“ID
  supplier_name TEXT,                    -- ä¾›åº”å•†åç§°
  purchase_quantity INTEGER,             -- è¿›è´§æ•°é‡
  purchase_price DECIMAL(10,2),         -- è¿›è´§ä»·æ ¼
  total_cost DECIMAL(10,2),             -- æ€»æˆæœ¬
  purchase_date DATE,                    -- è¿›è´§æ—¥æœŸ
  batch_number TEXT,                     -- æ‰¹æ¬¡å·
  expiry_date DATE,                      -- æœ‰æ•ˆæœŸ
  notes TEXT,                           -- å¤‡æ³¨
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (medicine_id) REFERENCES medicines (id)
);
```

### ç´¢å¼•è®¾è®¡

```sql
-- æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
CREATE INDEX idx_medicines_name ON medicines(name);
CREATE INDEX idx_orders_date ON sales_orders(order_date);
CREATE INDEX idx_orders_status ON sales_orders(status);
CREATE INDEX idx_inventory_medicine ON inventory_movements(medicine_id);
CREATE INDEX idx_inventory_type ON inventory_movements(movement_type);
CREATE INDEX idx_purchase_medicine ON purchase_records(medicine_id);
CREATE INDEX idx_purchase_date ON purchase_records(purchase_date);
```

## ğŸ”§ åç«¯APIè®¾è®¡

### APIæ¶æ„

```
src/
â”œâ”€â”€ index.ts                 # åº”ç”¨å…¥å£
â”œâ”€â”€ database/
â”‚   â””â”€â”€ init.ts             # æ•°æ®åº“åˆå§‹åŒ–å’Œè¿ç§»
â””â”€â”€ routes/
    â”œâ”€â”€ medicines.ts        # è¯å“ç®¡ç†API
    â”œâ”€â”€ hospitals.ts        # åŒ»é™¢ç®¡ç†API
    â”œâ”€â”€ doctors.ts          # åŒ»ç”Ÿç®¡ç†API
    â”œâ”€â”€ employees.ts        # å‘˜å·¥ç®¡ç†API
    â”œâ”€â”€ orders.ts           # è®¢å•ç®¡ç†API
    â””â”€â”€ inventory.ts        # åº“å­˜ç®¡ç†API ğŸ†•
```

### APIæ¥å£è®¾è®¡

#### 1. è¯å“ç®¡ç† (/api/medicines)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | å‚æ•° |
|------|------|------|------|
| GET | `/` | è·å–è¯å“åˆ—è¡¨ | - |
| GET | `/:id` | è·å–è¯å“è¯¦æƒ… | id |
| POST | `/` | åˆ›å»ºè¯å“ | name, specification, manufacturer, etc. |
| PUT | `/:id` | æ›´æ–°è¯å“ | id, æ›´æ–°å­—æ®µ |
| DELETE | `/:id` | åˆ é™¤è¯å“ | id |

#### 2. åº“å­˜ç®¡ç† (/api/inventory) ğŸ†•

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | å‚æ•° |
|------|------|------|------|
| GET | `/movements` | è·å–åº“å­˜å˜åŠ¨è®°å½• | - |
| GET | `/movements/:medicine_id` | è·å–ç‰¹å®šè¯å“å˜åŠ¨è®°å½• | medicine_id |
| GET | `/purchases` | è·å–è¿›è´§è®°å½• | - |
| POST | `/purchase` | æ·»åŠ è¿›è´§è®°å½• | medicine_id, supplier_name, quantity, etc. |
| POST | `/adjustment` | åº“å­˜è°ƒæ•´ | medicine_id, adjustment_type, quantity, notes |

#### 3. è®¢å•ç®¡ç† (/api/orders)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | å‚æ•° |
|------|------|------|------|
| GET | `/` | è·å–è®¢å•åˆ—è¡¨ | - |
| GET | `/:id` | è·å–è®¢å•è¯¦æƒ… | id |
| POST | `/` | åˆ›å»ºè®¢å• | hospital_id, doctor_id, employee_id, details |
| PUT | `/:id/status` | æ›´æ–°è®¢å•çŠ¶æ€ | id, status, payment_status |
| DELETE | `/:id` | åˆ é™¤è®¢å• | id |

### æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

#### 1. è®¢å•åˆ›å»ºæµç¨‹ ğŸ”„

```typescript
// è®¢å•åˆ›å»ºæ ¸å¿ƒé€»è¾‘
async function createOrder(orderData) {
  // 1. æ•°æ®éªŒè¯
  validateOrderData(orderData);

  // 2. åº“å­˜æ£€æŸ¥
  for (const detail of orderData.details) {
    const medicine = await getMedicine(detail.medicine_id);
    if (medicine.stock_quantity < detail.quantity) {
      throw new Error(`åº“å­˜ä¸è¶³ï¼Œå½“å‰åº“å­˜ï¼š${medicine.stock_quantity}ï¼Œéœ€è¦ï¼š${detail.quantity}`);
    }
  }

  // 3. å¼€å§‹äº‹åŠ¡
  db.run('BEGIN TRANSACTION');

  try {
    // 4. åˆ›å»ºè®¢å•
    const orderId = await insertOrder(orderData);

    // 5. åˆ›å»ºè®¢å•æ˜ç»†
    for (const detail of orderData.details) {
      await insertOrderDetail(orderId, detail);

      // 6. æ‰£å‡åº“å­˜
      await updateMedicineStock(detail.medicine_id, -detail.quantity);

      // 7. è®°å½•åº“å­˜å˜åŠ¨
      await insertInventoryMovement({
        medicine_id: detail.medicine_id,
        movement_type: 'out',
        quantity: detail.quantity,
        reference_type: 'order',
        reference_id: orderId
      });
    }

    // 8. æäº¤äº‹åŠ¡
    db.run('COMMIT');
    return { success: true, orderId };

  } catch (error) {
    // 9. å›æ»šäº‹åŠ¡
    db.run('ROLLBACK');
    throw error;
  }
}
```

#### 2. è¿›è´§ç®¡ç†æµç¨‹ ğŸ”„

```typescript
// è¿›è´§è®°å½•åˆ›å»ºé€»è¾‘
async function createPurchaseRecord(purchaseData) {
  db.run('BEGIN TRANSACTION');

  try {
    // 1. åˆ›å»ºè¿›è´§è®°å½•
    const purchaseId = await insertPurchaseRecord(purchaseData);

    // 2. æ›´æ–°åº“å­˜
    await updateMedicineStock(purchaseData.medicine_id, purchaseData.purchase_quantity);

    // 3. è®°å½•åº“å­˜å˜åŠ¨
    await insertInventoryMovement({
      medicine_id: purchaseData.medicine_id,
      movement_type: 'in',
      quantity: purchaseData.purchase_quantity,
      reference_type: 'purchase',
      reference_id: purchaseId
    });

    db.run('COMMIT');
    return { success: true, purchaseId };

  } catch (error) {
    db.run('ROLLBACK');
    throw error;
  }
}
```

#### 3. åº“å­˜è°ƒæ•´æµç¨‹ ğŸ”„

```typescript
// åº“å­˜è°ƒæ•´é€»è¾‘
async function adjustInventory(adjustmentData) {
  const { medicine_id, adjustment_type, quantity, notes } = adjustmentData;

  // 1. æ£€æŸ¥å½“å‰åº“å­˜
  const currentStock = await getCurrentStock(medicine_id);
  const adjustmentQuantity = adjustment_type === 'increase' ? quantity : -quantity;
  const newStock = currentStock + adjustmentQuantity;

  if (newStock < 0) {
    throw new Error('è°ƒæ•´ååº“å­˜ä¸èƒ½ä¸ºè´Ÿæ•°');
  }

  db.run('BEGIN TRANSACTION');

  try {
    // 2. æ›´æ–°åº“å­˜
    await updateMedicineStock(medicine_id, adjustmentQuantity);

    // 3. è®°å½•åº“å­˜å˜åŠ¨
    await insertInventoryMovement({
      medicine_id,
      movement_type: adjustment_type === 'increase' ? 'in' : 'out',
      quantity,
      reference_type: 'adjustment',
      reference_id: null,
      notes
    });

    db.run('COMMIT');
    return { success: true, oldStock: currentStock, newStock };

  } catch (error) {
    db.run('ROLLBACK');
    throw error;
  }
}
```

## ğŸ¨ å‰ç«¯æ¶æ„è®¾è®¡

### ç»„ä»¶æ¶æ„

```
src/
â”œâ”€â”€ components/              # å…¬å…±ç»„ä»¶
â”‚   â””â”€â”€ Layout.tsx          # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ pages/                  # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ Dashboard.tsx       # ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ Medicines.tsx       # è¯å“ç®¡ç†
â”‚   â”œâ”€â”€ Hospitals.tsx       # åŒ»é™¢ç®¡ç†
â”‚   â”œâ”€â”€ Doctors.tsx         # åŒ»ç”Ÿç®¡ç†
â”‚   â”œâ”€â”€ Employees.tsx       # å‘˜å·¥ç®¡ç†
â”‚   â”œâ”€â”€ Orders.tsx          # è®¢å•ç®¡ç†
â”‚   â””â”€â”€ Inventory.tsx       # åº“å­˜ç®¡ç† ğŸ†•
â”œâ”€â”€ services/               # APIæœåŠ¡
â”‚   â””â”€â”€ api.ts             # APIå°è£…
â”œâ”€â”€ types/                  # TypeScriptç±»å‹
â”‚   â””â”€â”€ index.ts           # ç±»å‹å®šä¹‰
â””â”€â”€ App.tsx                # åº”ç”¨å…¥å£
```

### çŠ¶æ€ç®¡ç†è®¾è®¡

#### 1. ç»„ä»¶çŠ¶æ€ç®¡ç†

```typescript
// å…¸å‹é¡µé¢ç»„ä»¶çŠ¶æ€ç»“æ„
interface PageState {
  // æ•°æ®çŠ¶æ€
  data: T[];
  loading: boolean;

  // UIçŠ¶æ€
  modalVisible: boolean;
  selectedRecord: T | null;

  // è¡¨å•çŠ¶æ€
  form: FormInstance;
}
```

#### 2. APIè°ƒç”¨å°è£…

```typescript
// APIæœåŠ¡å°è£…
class APIService {
  private api: AxiosInstance;

  constructor() {
    this.api = axios.create({
      baseURL: 'http://localhost:3001/api',
      timeout: 10000
    });

    // å“åº”æ‹¦æˆªå™¨
    this.api.interceptors.response.use(
      (response) => response.data,
      (error) => {
        // ç»Ÿä¸€é”™è¯¯å¤„ç†
        if (error.response?.data?.error) {
          error.message = error.response.data.error;
        }
        return Promise.reject(error);
      }
    );
  }
}
```

### å…³é”®ç»„ä»¶è®¾è®¡

#### 1. åº“å­˜ç®¡ç†ç»„ä»¶ ğŸ†•

```typescript
// Inventory.tsx ç»„ä»¶ç»“æ„
const Inventory: React.FC = () => {
  // çŠ¶æ€ç®¡ç†
  const [medicines, setMedicines] = useState<Medicine[]>([]);
  const [movements, setMovements] = useState<InventoryMovement[]>([]);
  const [purchases, setPurchases] = useState<PurchaseRecord[]>([]);

  // è¡¨å•ç®¡ç†
  const [purchaseForm] = Form.useForm();
  const [adjustmentForm] = Form.useForm();

  // ä¸šåŠ¡é€»è¾‘
  const loadData = async () => { /* æ•°æ®åŠ è½½é€»è¾‘ */ };
  const handlePurchase = async (values) => { /* è¿›è´§å¤„ç†é€»è¾‘ */ };
  const handleAdjustment = async (values) => { /* è°ƒæ•´å¤„ç†é€»è¾‘ */ };

  // æ¸²æŸ“é€»è¾‘
  return (
    <Tabs items={[
      { key: '1', label: 'åº“å­˜æ¦‚è§ˆ', children: <InventoryOverview /> },
      { key: '2', label: 'åº“å­˜å˜åŠ¨è®°å½•', children: <MovementHistory /> },
      { key: '3', label: 'è¿›è´§è®°å½•', children: <PurchaseHistory /> }
    ]} />
  );
};
```

#### 2. è®¢å•ç®¡ç†ç»„ä»¶æ”¹è¿› ğŸ”„

```typescript
// Orders.tsx å…³é”®æ”¹è¿›
const handleSubmit = async (values: any) => {
  try {
    const submitData = {
      ...values,
      order_date: values.order_date.format('YYYY-MM-DD'),
    };

    await orderAPI.create(submitData);
    message.success('åˆ›å»ºæˆåŠŸ');
    setModalVisible(false);
    loadOrders();
  } catch (error: any) {
    // æ”¹è¿›çš„é”™è¯¯å¤„ç†
    let errorMessage = 'åˆ›å»ºå¤±è´¥';
    if (error.response?.data?.error) {
      errorMessage = error.response.data.error;
    } else if (error.message) {
      errorMessage = error.message;
    }
    message.error(errorMessage);
  }
};
```

## ğŸ”„ æ•°æ®æµè®¾è®¡

### 1. è®¢å•åˆ›å»ºæ•°æ®æµ

```
ç”¨æˆ·å¡«å†™è®¢å•è¡¨å•
    â†“
å‰ç«¯è¡¨å•éªŒè¯
    â†“
è°ƒç”¨ orderAPI.create()
    â†“
åç«¯æ¥æ”¶è¯·æ±‚
    â†“
åº“å­˜æ£€æŸ¥
    â†“
å¼€å§‹æ•°æ®åº“äº‹åŠ¡
    â†“
åˆ›å»ºè®¢å•è®°å½•
    â†“
åˆ›å»ºè®¢å•æ˜ç»†
    â†“
æ‰£å‡åº“å­˜
    â†“
è®°å½•åº“å­˜å˜åŠ¨
    â†“
æäº¤äº‹åŠ¡
    â†“
è¿”å›æˆåŠŸå“åº”
    â†“
å‰ç«¯æ›´æ–°UI
```

### 2. åº“å­˜ç®¡ç†æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ (è¿›è´§/è°ƒæ•´)
    â†“
å‰ç«¯è¡¨å•éªŒè¯
    â†“
è°ƒç”¨åº“å­˜API
    â†“
åç«¯ä¸šåŠ¡é€»è¾‘å¤„ç†
    â†“
å¼€å§‹æ•°æ®åº“äº‹åŠ¡
    â†“
æ›´æ–°åº“å­˜æ•°é‡
    â†“
è®°å½•å˜åŠ¨å†å²
    â†“
æäº¤äº‹åŠ¡
    â†“
è¿”å›å“åº”
    â†“
å‰ç«¯åˆ·æ–°æ•°æ®
```

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†è®¾è®¡

### 1. å‰ç«¯é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†ç­–ç•¥
const handleError = (error: any, operation: string) => {
  console.error(`${operation}å¤±è´¥:`, error);

  let errorMessage = `${operation}å¤±è´¥`;
  if (error.response?.data?.error) {
    errorMessage = error.response.data.error;
  } else if (error.message) {
    errorMessage = error.message;
  }

  message.error(errorMessage);
};
```

### 2. åç«¯é”™è¯¯å¤„ç†

```typescript
// APIé”™è¯¯å“åº”æ ¼å¼
interface ErrorResponse {
  error: string;
  code?: string;
  details?: any;
}

// ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
const errorHandler = (err: Error, req: Request, res: Response, next: NextFunction) => {
  console.error('API Error:', err);

  const response: ErrorResponse = {
    error: err.message || 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  };

  res.status(500).json(response);
};
```

## ğŸ”§ éƒ¨ç½²é…ç½®

### 1. å¼€å‘ç¯å¢ƒ

```bash
# åç«¯å¯åŠ¨
cd pharma-management-backend
npm run dev  # ts-node src/index.ts

# å‰ç«¯å¯åŠ¨
cd pharma-management-frontend
npm run build && node serve-dist.js
```

### 2. ç”Ÿäº§ç¯å¢ƒé…ç½®

```typescript
// ç¯å¢ƒå˜é‡é…ç½®
const config = {
  port: process.env.PORT || 3001,
  dbPath: process.env.DB_PATH || './database.sqlite',
  corsOrigin: process.env.CORS_ORIGIN || 'http://localhost:8080'
};
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

- **ç´¢å¼•ç­–ç•¥**ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- **äº‹åŠ¡ç®¡ç†**ï¼šä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
- **è¿æ¥æ± **ï¼šSQLiteå•è¿æ¥ï¼Œé€‚åˆä¸­å°å‹åº”ç”¨

### 2. å‰ç«¯ä¼˜åŒ–

- **ä»£ç åˆ†å‰²**ï¼šä½¿ç”¨åŠ¨æ€å¯¼å…¥å‡å°‘åˆå§‹åŒ…å¤§å°
- **ç¼“å­˜ç­–ç•¥**ï¼šAPIå“åº”ç¼“å­˜ï¼Œå‡å°‘é‡å¤è¯·æ±‚
- **ç»„ä»¶ä¼˜åŒ–**ï¼šä½¿ç”¨React.memoé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

```typescript
// APIæµ‹è¯•ç¤ºä¾‹
describe('Inventory API', () => {
  test('should create purchase record', async () => {
    const purchaseData = {
      medicine_id: 1,
      supplier_name: 'æµ‹è¯•ä¾›åº”å•†',
      purchase_quantity: 100,
      purchase_price: 10.00
    };

    const response = await request(app)
      .post('/api/inventory/purchase')
      .send(purchaseData)
      .expect(201);

    expect(response.body.message).toBe('è¿›è´§è®°å½•æ·»åŠ æˆåŠŸ');
  });
});
```

### 2. é›†æˆæµ‹è¯•

```typescript
// ç«¯åˆ°ç«¯æµ‹è¯•
describe('Order Creation Flow', () => {
  test('should create order and update inventory', async () => {
    // 1. æ£€æŸ¥åˆå§‹åº“å­˜
    const initialStock = await getMedicineStock(1);

    // 2. åˆ›å»ºè®¢å•
    await createOrder({
      medicine_id: 1,
      quantity: 5
    });

    // 3. éªŒè¯åº“å­˜æ‰£å‡
    const finalStock = await getMedicineStock(1);
    expect(finalStock).toBe(initialStock - 5);
  });
});
```

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### 1. æ¨¡å—åŒ–è®¾è®¡

- **è·¯ç”±æ¨¡å—åŒ–**ï¼šæ¯ä¸ªä¸šåŠ¡æ¨¡å—ç‹¬ç«‹è·¯ç”±æ–‡ä»¶
- **ç»„ä»¶å¤ç”¨**ï¼šå…¬å…±ç»„ä»¶æŠ½å–ï¼Œæé«˜å¤ç”¨æ€§
- **APIæ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„APIè®¾è®¡è§„èŒƒ

### 2. æœªæ¥æ‰©å±•ç‚¹

- **ç”¨æˆ·æƒé™ç³»ç»Ÿ**ï¼šæ·»åŠ ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
- **æ•°æ®åˆ†ææ¨¡å—**ï¼šé”€å”®æ•°æ®ç»Ÿè®¡å’Œåˆ†æ
- **ç§»åŠ¨ç«¯é€‚é…**ï¼šå“åº”å¼è®¾è®¡æ”¯æŒç§»åŠ¨è®¾å¤‡
- **å¾®æœåŠ¡æ‹†åˆ†**ï¼šä¸šåŠ¡æ¨¡å—ç‹¬ç«‹éƒ¨ç½²

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.1.0*
*æœ€åæ›´æ–°ï¼š2025-05-27*
*é¡¹ç›®ä»“åº“ï¼šhttps://github.com/dlrkzzw/pharma-management-system*